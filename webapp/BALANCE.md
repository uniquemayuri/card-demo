BALANCE ADJUSTMENTS (2025-12-26)

概要
- 将本次对 `tetris.js` 中与关卡、得分、卡牌和宠物相关的数值调整整理为文档，作为平衡调整记录与后续微调依据。

修改汇总（按功能模块）

1) 关卡目标（LEVEL_TARGETS）
- 原： [300,800,2000,4000,7000,12000,30000,50000,100000,250000]
- 新： [300,900,2000,4000,7000,12000,20000,35000,60000,120000]
 - 理由：平滑进度，避免后期陡增造成体验断层。

2) 关卡时间
- 原：每关 `levelTimeLimit = 120s`。
- 新：`levelTimeLimit = 90s`。
- 理由：提高节奏感，缩短单次决策等待。

3) 失败惩罚（onLevelFail）
- 原：首次 10 / 二次 30 / 三次 50 / 其他 60（近似）
- 新：首 10 / 二 20 / 三 40 / 其他 50
- 理由：降低早期惩罚，鼓励反复尝试与学习。

4) 消行得分（sweep）
- 原：行数对应简单线性基数（rowCount*100）
- 新：采用经典单/双/三/四连基数并乘以等级：
  - 1 行 = 100
  - 2 行 = 300
  - 3 行 = 500
  - 4 行 = 800
- 再乘以 `player.level` 与 A 类加成(multiplier)
- 理由：保留连击奖励感，且与等级耦合更自然。

5) A 类卡牌（A1/A2/A4）调整
- A1 基础从 10% -> 8%（A+ 放大比例对应缩放）
- A2 基础从 5% -> 3%（与持有A类卡总数的乘算系数同样下降）
- A4 着陆奖励放大因子由每张 30% -> 15%
- 理由：防止 A 类堆叠导致分数快速膨胀，保持长期平衡。

额外：改变了“得分百分比加成”的计算方式，由之前的加法汇总改为乘法堆叠。
- 示例：如果 A1 的单张倍率为 8%（即 1.08），持有三张 A1 时，
  行分会被乘以 1.08 * 1.08 * 1.08 而不是 1 + 0.08*3。
- A+（升级）牌的倍率按其放大系数处理（例如 A+1 视为 5 倍的 A1 效果）。

6) 星层（B 类）调整
- 阈值基数由最低 1/10 改为 Math.max(3, 12 - B3_count)
- 星层得分倍率基底由 1.5^b2 -> 1.25^b2（增长更缓）
- 每次触发星层奖励从 1000 -> 200（更温和）
- 星爆炸（B4）每块奖励从 1000 -> 300，消耗星层 50 -> 40
- 星爆炸触发门槛从 50（猎人 40）→ 45（猎人 35）
- 理由：使星层系统不再过强，同时保持可玩性的策略性触发点。

7) 恐龙（C 类）调整
- 恐龙吃底层触发频率：从每 20 次着陆 -> 每 15 次着陆
- 吃底层每块基础奖励由 500*(1+0.8*c4) -> 200*(1+0.5*c4)
- 勋章（badge）加成由每块大量加分 -> 更温和的 200*count*(1+0.3*c4)
- 理由：提高宠物触发频率但大幅降低单次奖励，避免一次性爆分并保持长期成长价值。

8) 星爆炸与恐龙奖励统一走“更温和”策略，避免短时间内过度堆分。

9) 经济（金币）节奏
- 通关奖励从 +2 金币 -> +5 金币。
- 理由：让玩家更快能与商店互动，促进循环玩法。
 - 通关奖励从 +2 金币 -> +5 金币。
 - 理由：让玩家更快能与商店互动，促进循环玩法。

附加更新（测试模式与 D 类）
- 新增 `测试模式`（可在开始界面选择）。测试模式特点：
  - 开局无角色选择与角色机制；取而代之的是开局选择一个卡牌类别（`A`/`B`/`C`/`D`）。
  - 本局通关奖励与商店中出现的卡牌类别，仅限为所选类别（便于集中测试该类交互）。
  - 如果在测试模式下通关第 10 关，则解锁第 11 关：第 11 关无过关目标，仅在限时内尽可能得分，时间结束时将该局第 11 关的得分记录到本地排行榜。
  - 本地排行榜使用 `localStorage` 保存（键 `tetris_lb_v1`），并可在开始界面查看。

 - 已新增文件： `webapp/UPDATE_D.md`（记录 D 类卡与颜色机制的说明）。

10) 速度曲线
- 下落间隔函数由 Math.max(1000 - (lvl-1)*100, 100) 改为 Math.max(1000 - (lvl-1)*80, 120)
- 理由：放缓高等级极限加速，提升可控性与策略空间。

文件与位置
- 本次调整均已修改： `webapp/tetris.js`
- 本文档： `webapp/BALANCE.md`（当前文件）

测试建议
- 在本地启动静态服务器并在浏览器中试玩 1-3 个关卡：
  - 打开： http://127.0.0.1:8000/
  - 检查：关卡目标、计时、通关后奖励金币、星层触发频率、恐龙进化与吃底效果。
- 重点观察：分数增长速率、金币获取速度与失败后的恢复性体验。

后续调整建议
- 根据试玩数据再微调：
  - 若分数仍然增长过快 → 进一步压缩 A 类系数或降低单次基准分。
  - 若游戏太苛刻 → 增加 HP 或提高通关金币。
  - 对恐龙/星层的视觉提示与动画时长也可微调以改善反馈节奏。

记录
- 修改者：助手（由脚本直接修改 `webapp/tetris.js`）
- 日期：2025-12-26

---
如需我把这份文档改为 README 风格或加入具体代码片段/行号注释，我可以继续更新。